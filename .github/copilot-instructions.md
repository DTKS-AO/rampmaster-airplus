<!--
Guidance for AI coding agents working on the Rampmaster AirPlus front-end.
Keep this file short and focused: architecture, key workflows, patterns, and example entry points.
-->
# Copilot instructions for rampmaster-airplus

Summary
- This is a Vite + React + TypeScript single-page application scaffolded with shadcn-ui and Tailwind.
- Supabase is the primary backend (see `src/integrations/supabase/*`) and the project relies on the generated `types.ts` for typed DB access.

What to prioritize
- Preserve src structure and shadcn component patterns under `src/components/ui/` (small, presentational components).
- Keep routing in `src/App.tsx` (React Router). Add new pages in `src/pages/` and register routes there.
- Use the typed Supabase client exported from `src/integrations/supabase/client.ts` and the `Database` types in `src/integrations/supabase/types.ts`.

Key files to inspect before changing behavior
- `package.json` — dev scripts: `npm run dev`, `npm run build`, `npm run preview`, and `npm run lint`.
- `vite.config.ts` — dev server runs on host :: port 8080 and aliases `@` -> `./src`.
- `src/main.tsx` — app entry; imports `App` and global CSS.
- `src/App.tsx` — routes and global providers (React Query, tooltips, sonner toaster).
- `src/components/layout/MainLayout.tsx` — main shell including header, nav, sign-out and mobile menu (uses `supabase.auth.signOut()` and `sonner` toast).
- `src/integrations/supabase/client.ts` and `src/integrations/supabase/types.ts` — supabase client and generated DB types (do not change autogenerated keys).

Patterns & conventions
- UI: follow shadcn-inspired components in `src/components/ui/*`. Components are small, typed, and composed.
- Routing: add routes in `src/App.tsx`. The comment warns to add custom routes above the catch-all `*` route.
- State & data fetching: React Query is used globally (`@tanstack/react-query`). Prefer queries/mutations via React Query hooks.
- Authentication: Supabase client persists session in localStorage and is used directly (see `MainLayout` sign-out flow). For pages that require auth, check for `user` prop being passed into `MainLayout`.
- Types-first: Supabase DB types are generated and used across the codebase — prefer using them (Tables/TablesInsert/TablesUpdate) when interacting with the DB.

Integration points & secrets
- Supabase public URL/key are present in `src/integrations/supabase/client.ts` (this file was generated). Treat the key as a publishable key — do not move it to server-only code here. Avoid adding private secrets to the repo.
- External libs of interest: `react-router-dom`, `@tanstack/react-query`, `@supabase/supabase-js`, `sonner`, `lucide-react`, Tailwind and shadcn style system.

Build & dev workflows
- Install: `npm i` (project assumes Node & npm).
- Dev server: `npm run dev` (Vite serves on port 8080 by default and uses `@` alias).
- Build: `npm run build` (or `npm run build:dev` for development build mode).
- Lint: `npm run lint` (ESLint configured).

Small examples (where to change behavior)
- Add a page: create `src/pages/MyFeature.tsx`, export a default React component, then add a `<Route path="/my-feature" element={<MyFeature />} />` entry in `src/App.tsx` above the `*` route.
- Use Supabase with types: import { supabase } from "@/integrations/supabase/client"; then call `const { data, error } = await supabase.from('aircraft').select('*')`; prefer typed access: `supabase.from<Tables<'aircraft'>>('aircraft')` or use helpers from `types.ts`.
- Add a UI component: follow the pattern in `src/components/ui/button.tsx` (presentational, accepts className and size/variant props via cva/clsx).

Do not change without review
- The generated Supabase types and client file — they are regenerated by the upstream migration process; avoid manual edits unless intentionally replacing generation.
- Global layout or provider patterns in `src/App.tsx` without adapting providers (React Query, TooltipProvider, Toaster).

Where to look for more context
- DB schema & migrations: `supabase/migrations/` and `supabase/config.toml`.
- Project README: `README.md` (includes Lovable references used for original scaffolding).

If anything is unclear
- Ask for the specific file and the intended change. Point to relevant providers (React Query, Router, Supabase) if the change touches data flow or auth.
<!--
Copilot instructions for rampmaster-airplus

Short, actionable guidance so AI coding agents can be productive quickly.
Includes code-level patterns and the product vision required for correct changes.
-->

# Quick summary
- Vite + React + TypeScript SPA. UI built with shadcn-style components and Tailwind.
- Supabase is the primary backend (Auth, Postgres, Storage). Generated types live in `src/integrations/supabase/types.ts`.

# Product context (short)
- AirPlus AAMS: multi-tenant reporting and ramp operations for AirPlus Angola. AirPlus (provider) manages fleet, staff and shifts; clients only see their reports/KPIs.
- Key UX constraints: online-only, PWA-installable, mobile-first, lightweight, photos + signatures mandatory in report workflow, PDFs generated in the frontend, uploads to Supabase Storage.

# Roles & RBAC (where to check)
- Roles (examples): `super_admin`, `gestor`, `supervisor`, `tecnico`, `auxiliar`, `cliente` (see `src/integrations/supabase/types.ts` enums).
- Access enforced via Supabase RLS + role claims. Typical permission domains: `user.*`, `aircraft.*`, `employee.*`, `turno.*`, `report.*`, `export.*`, `audit.*`, `client.config`, `system.*`.

# Key modules (what you'll encounter/change)
- Operations: aircraft, employees, shifts (CRUD + RLS). Example files: `src/pages/Aircraft.tsx`, `src/pages/Employees.tsx`.
- Reports: multi-step workflow (info -> employees -> photos -> signatures -> export). Photos stored in Supabase Storage; PDFs generated client-side.
- Dashboards: Recharts-based KPIs with filters and exports.
- Configs & services: service types, client branding, report templates. Changes must preserve historical reports (versioning behavior).
- Audit: all create/update/delete/export actions must be logged (look for `created_by`, `updated_by`, `created_at`, `updated_at` fields in `types.ts`).

# Code-level patterns & conventions
- UI components: `src/components/ui/*` follow shadcn patterns—small, presentational, accept `className` and props.
- Routing: `src/App.tsx` centralizes routes. Add new routes above the catch-all `*` route.
- Data fetching: `@tanstack/react-query` is used globally. Use queries/mutations + cache invalidation patterns.
- Supabase: import `supabase` from `src/integrations/supabase/client.ts` and prefer typed calls using `types.ts` (e.g. `supabase.from<Tables<'aircraft'>>('aircraft')`).
- Auth/session: Supabase client persists session to localStorage (see `client.ts`). `MainLayout` shows sign-out flow.

# Build, run & lint
- Install deps: `npm i`.
- Dev: `npm run dev` (Vite uses host `::` and port `8080`, `@` alias -> `./src`).
- Build: `npm run build` (or `npm run build:dev`).
- Preview: `npm run preview`.
- Lint: `npm run lint`.

# Important implementation rules (do not skip)
- PDFs are generated client-side; keep rendering deterministic and avoid server-side rendering for PDFs.
- Photo uploads MUST use Supabase Storage with secure paths; images are required for report publish flow.
- Do not manually edit generated Supabase files (`client.ts`, `types.ts`). They are regenerated from migrations.
- Preserve report history: changes to service types/configs apply to future reports only; do not mutate historical report payloads.
- Audit every critical mutation (create/update/delete/export) and include `created_by`/`updated_by` when possible.
- The app is online-only: avoid introducing offline caching or service-worker caching beyond PWA installability.

# Small examples (quick copy-paste)
- Add a page: create `src/pages/MyFeature.tsx` (export default component) and add a route in `src/App.tsx` above `*`.
- Typed Supabase select:
	- `import { supabase } from '@/integrations/supabase/client';`
	- `const { data, error } = await supabase.from<Tables<'aircraft'>>('aircraft').select('*');`

# Where to look for more context
- Routing & providers: `src/App.tsx`.
- Global layout and auth: `src/components/layout/MainLayout.tsx`.
- Supabase client & DB types: `src/integrations/supabase/client.ts`, `src/integrations/supabase/types.ts`.
- Pages: `src/pages/*` (Dashboard, Auth, Aircraft, Employees, etc.).
- DB migrations: `supabase/migrations/` and `supabase/config.toml`.
- Project README contains Lovable scaffolding notes.

# Deliverable rules (from product)
- Documentation first: ERD, RBAC, API spec, migrations and seeds must be prepared before large feature commits.
- Follow the 6-sprint plan: base docs -> operations -> reports -> dashboards -> services/configs -> QA & deploy.

If anything is unclear, ask which file/area and whether the requested change affects data model, RLS, or client-side PDF/audit behavior.

— end
